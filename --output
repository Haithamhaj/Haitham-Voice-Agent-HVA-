---
description: ðŸ›¡ï¸ PROJECT SNAPSHOT - Read before ANY action
globs: **/*
alwaysApply: true
---

# ðŸ§  Haitham Voice Agent (HVA) SNAPSHOT
> âš ï¸ READ THIS BEFORE ANY CODE CHANGE
> Auto-synced: 2025-12-06 13:20

---

## IDENTITY
```yaml
name: Haitham Voice Agent (HVA)
purpose: Here is the full, updated `README.md` content:
status: development
```

---

## TECH_STACK
> âŒ DO NOT SUGGEST ALTERNATIVES
```yaml
backend: FastAPI
database: SQLite
```

---

## DEPENDENCIES
```yaml
frontend:
  # No frontend dependencies detected
backend:
  openai: latest
  google-generativeai: latest
  chromadb: latest
  gspread: latest
  soundfile: latest
  sounddevice: latest
  SpeechRecognition: latest
  pyaudio: latest
  cffi: latest
  python-dotenv: latest
  faster-whisper: latest
  aiosqlite: latest
  beautifulsoup4: latest
  keyring: latest
  keyrings.alt: latest
  google-auth-oauthlib: latest
  google-auth: latest
  google-api-python-client: latest
  numpy: latest
  scipy: latest
  cryptography: latest
  transformers: latest
  torch: latest
  pytest-asyncio: 1.3.0
  PyPDF2: 3.0.1
  regex: 2025.11.3
  rumps: latest
  pynput: latest
  fastapi>=0.104.0: latest
  uvicorn>=0.24.0: latest
  websockets>=12.0: latest
  dateparser: latest
  psutil: latest
  sentence-transformers: latest
```

---

## ENV_VARS
```yaml
required:
  - OPENAI_API_KEY: TODO: add description
  - GEMINI_API_KEY: TODO: add description
  - LOG_LEVEL: TODO: add description
optional:
  # Add optional vars here
```

---

## FILES
> ðŸ“‚ CHECK HERE BEFORE CREATING ANY FILE
```
analyze_cost.py: analyze_cost | analyze
analyze_report.py: analyze_report | -
api/__init__.py: __init__-endpoints | -
api/connection_manager.py: connection_manager-endpoints | connect, disconnect, broadcast
api/main.py: main-endpoints | startup_event, root, health_check, websocket_endpoint
api/routes/__init__.py: __init__-endpoints | -
api/routes/calendar.py: calendar-endpoints | get_today_events
api/routes/chat.py: chat-endpoints | chat
api/routes/checkpoints.py: checkpoints-endpoints | get_checkpoints, rollback_checkpoint
api/routes/files.py: files-endpoints | scan_files, ingest_file, plan_organization, execute_organization, rollback_checkpoint
api/routes/gmail.py: gmail-endpoints | get_unread_emails
api/routes/memory.py: memory-endpoints | get_memory_stats, search_memory
api/routes/system.py: system-endpoints | get_system_status, get_system_health, get_system_logs, save_report
api/routes/tasks.py: tasks-endpoints | get_tasks
api/routes/usage.py: usage-endpoints | get_usage_stats, get_usage_logs
api/routes/voice.py: voice-endpoints | start_listening, stop_listening
check_memory.py: check_memory | check_memory
check_schema.py: check_schema | check_schema
check_vector.py: check_vector | check_vector
desktop/dist_renderer/assets/index-Bq_QJ4n6.js: index-bq_qj4n6 | yd, Rn, dr, Vl, at
desktop/eslint.config.js: eslint.config | -
desktop/main.js: entry-point | startApi, createWindow
desktop/postcss.config.js: postcss.config | -
desktop/preload.js: preload | -
desktop/src/App.jsx: entry-point | App, AppContent
desktop/src/components/common/Toast.jsx: toast | removeToast, addToast, Toast
desktop/src/components/dashboard/CheckpointsWidget.jsx: checkpointswidget | handleRollback, fetchCheckpoints, toggleExpand, CheckpointsWidget, formatDate
desktop/src/components/dashboard/FileSystemTree.jsx: filesystemtree | getIcon, handleLoadChildren, FileSystemTree, updateNode, TreeNode
desktop/src/components/dashboard/SystemHealthWidget.jsx: systemhealthwidget | getStatusColor, fetchHealth, SystemHealthWidget, handleCleanCache, catch
desktop/src/components/dashboard/TaskProgressWidget.jsx: taskprogresswidget | addLog, handleMessage, TaskProgressWidget, connect
desktop/src/components/dashboard/UsageDetailsModal.jsx: usagedetailsmodal | catch, UsageDetailsModal, fetchData
desktop/src/components/dashboard/UsageWidget.jsx: usagewidget | UsageWidget, catch, fetchStats
desktop/src/components/layout/Sidebar.jsx: sidebar | Sidebar
desktop/src/components/layout/TitleBar.jsx: titlebar | handleMinimize, handleClose, TitleBar, handleMaximize
desktop/src/components/voice/VoiceOverlay.jsx: voiceoverlay | VoiceOverlay
desktop/src/context/ChatContext.jsx: chatcontext | ChatProvider, setMessages, useChatContext
desktop/src/context/WebSocketContext.jsx: websocketcontext | toggleListening, WebSocketProvider, connectWs, useWebSocketContext, catch
desktop/src/developer-toolkit/ToolkitView.jsx: toolkitview | generateReport, exportReport, getLevelIcon, saveReportToAI, getLevelColor
desktop/src/developer-toolkit/diagnostics.js: diagnostics | diagnoseError
desktop/src/developer-toolkit/logger.js: logger | getLogs, addLog, emitError, clear, subscribe
desktop/src/developer-toolkit/networkMonitor.js: networkmonitor | clear, subscribe, useNetworkMonitor, logResponse, constructor
desktop/src/hooks/useWebSocket.js: usewebsocket-logic | catch, connectWs, useWebSocket
desktop/src/main.jsx: entry-point | -
desktop/src/pages/CalendarView.jsx: calendarview-page | CalendarView
desktop/src/pages/ChatView.jsx: chatview-page | renderMessageContent, setMessages, ChatView, handleReject, handleVoiceToggle
desktop/src/pages/Dashboard.jsx: dashboard-page | catch, fetchStats, Dashboard
desktop/src/pages/GmailView.jsx: gmailview-page | GmailView, fetchEmails
desktop/src/pages/LogsView.jsx: logsview-page | fetchStateData, catch, fetchBackendLogs, LogsView
desktop/src/pages/MemoryView.jsx: memoryview-page | handleSearch, MemoryView
desktop/src/pages/SettingsView.jsx: settingsview-page | SettingsView
desktop/src/pages/TasksView.jsx: tasksview-page | TasksView
desktop/src/services/api.js: api-service | catch, monitoredFetch
desktop/tailwind.config.js: tailwind.config | -
desktop/vite.config.js: vite.config | -
haitham_voice_agent/__init__.py: __init__ | -
haitham_voice_agent/config.py: config | validate_config, ensure_directories, resolve_model, init_gemini_mapping, resolve_gemini_model
haitham_voice_agent/dispatcher.py: dispatcher | get_dispatcher, dispatch_action, register_tool, dispatch, execute_plan
haitham_voice_agent/domain/models.py: models | to_dict, from_dict, to_dict, from_dict, to_dict
haitham_voice_agent/gui_process.py: gui_process | run_gui_process, create_window, init_dashboard_view, send_listen_command, send_text_command
haitham_voice_agent/gui_widgets.py: gui_widgets | on_enter, on_leave, on_click, set_status, update_stats
haitham_voice_agent/hva_menubar.py: hva_menubar | main, start_listening, reset_state, show_window, clear_history
haitham_voice_agent/intelligence/adaptive_sync.py: adaptive_sync | ensure_initialized, calculate_file_hash, sync_knowledge_base, audit_fingerprints
haitham_voice_agent/intelligence/content_extractor.py: content_extractor | extract_text
haitham_voice_agent/intelligence/file_router.py: file_router | classify_file
haitham_voice_agent/intelligence/optimization_guard.py: optimization_guard | get_optimization_guard, check_file, save_result
haitham_voice_agent/intelligence/smart_summarizer.py: smart_summarizer | summarize_content
haitham_voice_agent/intent_router.py: intent_router | detect_arabic_save_note, route_command, route_command
haitham_voice_agent/llm_router.py: llm_router | get_router, route, generate_with_gemini, generate_with_gpt, generate_execution_plan
haitham_voice_agent/main.py: entry-point | validate_config, main, initialize_async, speak, process_command_mode
haitham_voice_agent/memory/graph_store.py: graph_store | get_graph_store, load_graph, save_graph, add_node, add_edge
haitham_voice_agent/memory/manager.py: manager | get_memory_manager, initialize, create_project, save_thought, auto_summarize
haitham_voice_agent/memory/vector_store.py: vector_store | get_vector_store, add_document, search
haitham_voice_agent/model_router.py: model_router | choose_model
haitham_voice_agent/ollama_orchestrator.py: ollama_orchestrator | get_orchestrator, classify_request
haitham_voice_agent/tests/test_bridge_live.py: test_bridge_live | test_bridge_live
haitham_voice_agent/tests/test_config.py: test_config | test_config_paths_exist, test_config_has_required_keys, test_config_supported_languages, test_config_gmail_scopes, test_config_memory_paths
haitham_voice_agent/tests/test_gemini_routing.py: test_gemini_routing | test_massive_context_uses_pro, test_high_risk_uses_pro, test_multi_step_reasoning_uses_pro, test_doc_analysis_document_uses_pro, test_comparison_document_uses_pro
haitham_voice_agent/tests/test_gmail_llm.py: test_gmail_llm | llm_helpers, test_summarize_email_wrapper, test_summarize_email_basic, test_summarize_email_detailed, test_summarize_thread
haitham_voice_agent/tests/test_llm_router.py: test_llm_router | router, test_router_initialization, test_routing_to_gemini, test_routing_to_gpt, test_execution_plan_generation
haitham_voice_agent/tests/test_memory_foundation.py: test_memory_foundation | memory_system, test_add_memory, test_search_memory, test_delete_memory
haitham_voice_agent/tests/test_memory_live.py: test_memory_live | test_memory_live_smoke
haitham_voice_agent/tests/test_model_router.py: test_model_router | test_low_risk_classification_uses_logical_nano, test_low_risk_classification_background_uses_batch_flex, test_medium_risk_classification_uses_logical_nano_plus, test_planning_uses_logical_mini, test_tool_calling_uses_logical_mini
haitham_voice_agent/tests/test_tools.py: test_tools | file_tools, doc_tools, browser_tools, terminal_tools, test_list_files
haitham_voice_agent/tests/test_voice_local.py: test_voice_local | mock_whisper, test_whisper_init, test_recorder_lifecycle, test_main_test_mode
haitham_voice_agent/token_tracker.py: token_tracker | get_tracker, reload_pricing, track_usage, calculate_cost
haitham_voice_agent/tools/__init__.py: __init__ | -
haitham_voice_agent/tools/advisor.py: advisor | get_advisor, check_resources, check_wellbeing, validate_action
haitham_voice_agent/tools/arabic_normalizer.py: arabic_normalizer | normalize_arabic_text
haitham_voice_agent/tools/browser.py: browser | open_url, search_google, test
haitham_voice_agent/tools/calendar.py: calendar | authorize, list_events, check_availability, create_event, test
haitham_voice_agent/tools/checkpoint_manager.py: checkpoint_manager | get_checkpoint_manager, ensure_initialized, create_checkpoint, get_checkpoints, rollback_checkpoint
haitham_voice_agent/tools/deep_organizer.py: deep_organizer | get_deep_organizer, scan_and_plan, execute_plan
haitham_voice_agent/tools/docs.py: docs | summarize_file, translate_file, compare_files, extract_tasks, read_pdf
haitham_voice_agent/tools/drive.py: drive | authorize, list_files, search_files, test
haitham_voice_agent/tools/files.py: files | list_files, create_folder, delete_folder, delete_file, search_files
haitham_voice_agent/tools/gemini/__init__.py: __init__ | -
haitham_voice_agent/tools/gemini/gemini_router.py: gemini_router | choose_gemini_variant
haitham_voice_agent/tools/gemini/model_discovery.py: model_discovery | get_best_model, resolve_gemini_mapping
haitham_voice_agent/tools/gmail/__init__.py: __init__ | -
haitham_voice_agent/tools/gmail/auth/__init__.py: __init__ | -
haitham_voice_agent/tools/gmail/auth/credentials_store.py: credentials_store | get_credential_store, store_credential, retrieve_credential, delete_credential, has_credential
haitham_voice_agent/tools/gmail/auth/oauth_flow.py: oauth_flow | get_oauth_flow, get_credentials, authorize, revoke_credentials, has_credentials
haitham_voice_agent/tools/gmail/connection_manager.py: connection_manager | fetch_latest_email, search_emails, get_email_by_id, create_draft, send_draft
haitham_voice_agent/tools/gmail/gmail_api_handler.py: gmail_api_handler | fetch_latest_email, search_emails, get_email_by_id, create_draft, list_drafts
haitham_voice_agent/tools/gmail/imap_handler.py: imap_handler | fetch_latest_email, search_emails, get_email_by_id, close, test
haitham_voice_agent/tools/gmail/llm_helper.py: llm_helper | get_email_llm_helpers, summarize_email, summarize_email_content, summarize_thread, extract_email_actions
haitham_voice_agent/tools/gmail/memory_integration.py: memory_integration | initialize, save_email_to_memory
haitham_voice_agent/tools/gmail/models/__init__.py: __init__-model | -
haitham_voice_agent/tools/gmail/models/email_message.py: email_message-model | to_dict, from_dict, get_sender_name, get_sender_email, to_dict
haitham_voice_agent/tools/gmail/prompts.py: prompts | get_reply_style_description, get_reply_tone_description, get_reply_type_description, get_language_name
haitham_voice_agent/tools/gmail/smtp_handler.py: smtp_handler | send_email, create_draft, test
haitham_voice_agent/tools/gmail/utils/__init__.py: __init__-utils | -
haitham_voice_agent/tools/gmail/utils/text_processing.py: text_processing-utils | extract_plain_text_from_html, parse_email_address, parse_email_list, clean_email_body, extract_snippet
haitham_voice_agent/tools/memory/__init__.py: __init__ | -
haitham_voice_agent/tools/memory/intelligence/__init__.py: __init__ | -
haitham_voice_agent/tools/memory/intelligence/classifier.py: classifier | classify
haitham_voice_agent/tools/memory/intelligence/prompts.py: prompts | -
haitham_voice_agent/tools/memory/intelligence/summarizer.py: summarizer | summarize
haitham_voice_agent/tools/memory/memory_system.py: memory_system | initialize, get_stats, suggest_file_project, ingest_file, index_file
haitham_voice_agent/tools/memory/models/__init__.py: __init__-model | -
haitham_voice_agent/tools/memory/models/memory.py: memory-model | to_dict, from_dict
haitham_voice_agent/tools/memory/storage/__init__.py: __init__ | -
haitham_voice_agent/tools/memory/storage/graph_store.py: graph_store | initialize, add_node, add_edge, get_related, count_nodes
haitham_voice_agent/tools/memory/storage/sqlite_store.py: sqlite_store | initialize, get_optimization_cache, save_optimization_cache, log_learning_event, get_learning_events_by_category
haitham_voice_agent/tools/memory/storage/vector_store.py: vector_store | add_embedding, search, delete_embedding, count
haitham_voice_agent/tools/memory/utils/__init__.py: __init__-utils | -
haitham_voice_agent/tools/memory/utils/embeddings.py: embeddings-utils | generate
haitham_voice_agent/tools/memory/voice_tools.py: voice_tools | ensure_initialized, get_stats, process_voice_note, search_memory_voice, get_last_note
haitham_voice_agent/tools/notifications/manager.py: manager | start, stop, check_calendar, check_gmail
haitham_voice_agent/tools/pricing_tools.py: pricing_tools | get_current_pricing, update_pricing, check_pricing_updates
haitham_voice_agent/tools/projects.py: projects | create_project, list_projects, list_critical_projects, get_project
haitham_voice_agent/tools/reminders.py: reminders | ensure_list_exists, fetch_inbox_tasks, mark_complete, add_task
haitham_voice_agent/tools/reminders_watcher.py: reminders_watcher | run, stop
haitham_voice_agent/tools/secretary.py: secretary | get_secretary, get_morning_briefing, set_work_mode
haitham_voice_agent/tools/simple_organizer.py: simple_organizer | get_simple_organizer, scan_and_plan, execute_plan
haitham_voice_agent/tools/smart_organizer.py: smart_organizer | get_organizer, organize_old_downloads, organize_downloads
haitham_voice_agent/tools/system_awareness/__init__.py: __init__ | get_system_awareness, start, find_file, get_app_path, get_recent_files
haitham_voice_agent/tools/system_awareness/deep_search.py: deep_search | search
haitham_voice_agent/tools/system_awareness/file_watcher.py: file_watcher | start, stop, on_any_event
haitham_voice_agent/tools/system_awareness/quick_indexer.py: quick_indexer | update_index, load_index, find_in_index, search_list
haitham_voice_agent/tools/system_awareness/system_profiler.py: system_profiler | load_profile, run_profile, get_app_path
haitham_voice_agent/tools/system_sentry.py: system_sentry | check_health, find_hogs, clean_cache
haitham_voice_agent/tools/system_tools.py: system_tools | open_app, set_volume, mute_volume, unmute_volume, sleep_display
haitham_voice_agent/tools/tasks/task_manager.py: task_manager | create_task, list_tasks, update_task, complete_task, delete_task
haitham_voice_agent/tools/terminal.py: terminal | execute_command, list_allowed_commands
haitham_voice_agent/tools/voice/__init__.py: __init__ | -
haitham_voice_agent/tools/voice/models.py: models | init_whisper_models
haitham_voice_agent/tools/voice/recorder.py: recorder | start, stop, is_recording
haitham_voice_agent/tools/voice/stt.py: stt | count_arabic_chars, capture_audio, listen_realtime, transcribe_command, transcribe_session
haitham_voice_agent/tools/voice/stt_google.py: stt_google | transcribe_arabic_google
haitham_voice_agent/tools/voice/stt_langid.py: stt_langid | detect_language_whisper
haitham_voice_agent/tools/voice/stt_whisper_ar.py: stt_whisper_ar | transcribe_arabic_whisper
haitham_voice_agent/tools/voice/stt_whisper_en.py: stt_whisper_en | transcribe_english_whisper
haitham_voice_agent/tools/voice/tts.py: tts | speak, speak_to_file
haitham_voice_agent/tools/workspace_manager.py: workspace_manager | get_project_folder, ensure_project_structure, project_notes_dir, project_tasks_file, project_attachments_dir
haitham_voice_agent/tts.py: tts | get_tts, set_callback, speak, play_sound, speak_ar
haitham_voice_agent/wake_word.py: wake_word | get_detector, detect, has_wake_word
query_last_checkpoint.py: query_last_checkpoint | get_last_checkpoint
repro_sort.py: repro_sort | test_sort
reset_pricing.py: reset_pricing | reset_pricing
run_audit.py: run_audit | run_audit
scripts/auth_all.py: auth_all | authorize_all
scripts/auth_calendar.py: auth_calendar | -
scripts/compare_stt.py: compare_stt | test_whisper_api, test_google_stt, test_wav2vec2, main
scripts/create_app_bundle.py: create_app_bundle | create_app_bundle
scripts/create_launcher.py: create_launcher | create_launcher
scripts/health_check.py: health_check | check_ollama, check_env_vars, check_imports, main
scripts/migrate_db_v1_1.py: migrate_db_v1_1 | migrate_db
scripts/migrate_db_v1_2.py: migrate_db_v1_2 | migrate_db
scripts/record_test_audio.py: record_test_audio | -
scripts/test_advisor.py: test_advisor | test_advisor
scripts/test_calendar_timezone.py: test_calendar_timezone | test_calendar_timezone
scripts/test_calendar_tool.py: test_calendar_tool | test_calendar_logic
scripts/test_clarification.py: test_clarification | test_clarification_loop
scripts/test_dashboard.py: test_dashboard | test_dashboard
scripts/test_feedback_agent.py: test_feedback_agent | test_feedback_agent
scripts/test_gpt_router.py: test_gpt_router | test_gpt_router
scripts/test_idea_agent.py: test_idea_agent | test_idea_agent
scripts/test_llm_date_parsing.py: test_llm_date_parsing | test_llm_parsing
scripts/test_memory_layer1.py: test_memory_layer1 | test_memory_layer1
scripts/test_memory_layer2.py: test_memory_layer2 | test_memory_layer2
scripts/test_memory_layer3.py: test_memory_layer3 | test_memory_layer3
scripts/test_memory_v1_1.py: test_memory_v1_1 | test_memory_v1_1
scripts/test_organizer.py: test_organizer | test_organizer
scripts/test_reminders_sync.py: test_reminders_sync | test_reminders_sync
scripts/test_secretary.py: test_secretary | test_secretary
scripts/test_show_files.py: test_show_files | main
scripts/test_system_modes.py: test_system_modes | test_modes
scripts/test_timezone_parsing.py: test_timezone_parsing | test_parsing
scripts/test_visual_mode.py: test_visual_mode | test_visual_mode
scripts/update_readme.py: update_readme | scan_codebase, update_readme
scripts/verify_models.py: verify_models | verify_models
test_adaptive.py: test_adaptive | test_sync
test_chat_integration.py: test_chat_integration | test_chat
test_deep_organizer.py: test_deep_organizer | test_organizer
test_orchestrator.py: test_orchestrator | test
test_organizer.py: test_organizer | test_smart_organizer
test_organizer_data/random_script.py: random_script | -
test_qwen_3b.py: test_qwen_3b | test_routing, test_summarization, main
test_rollback.py: test_rollback | test_rollback
test_sentry.py: test_sentry | main
test_token_tracker.py: test_token_tracker | test_token_tracker
test_ws.py: test_ws | test_ws
trigger_cleanup.py: trigger_cleanup | main
verify_integrity.py: verify_integrity | check_imports, check_tool_instantiation
verify_organizer.py: verify_organizer | test_organizer

```

---

## CONNECTIONS
```yaml
  port_11434: haitham_voice_agent/config.py
  port_8765: api/main.py
  port_5173: desktop/main.js
```

---

## RUN
> âš¡ USE EXACTLY THESE COMMANDS
```bash
backend: cd api && uvicorn main:app --reload
```

---

## LOCKED
> ðŸ”’ CANNOT CHANGE WITHOUT USER APPROVAL
```yaml
# Add locked decisions here
# Example: - React: framework # locked: PERMANENT
```

---

## DANGER
> âš ï¸ THESE FILES BREAK EASILY
```yaml
# Add dangerous files here
# Example: - path: main.py, reason: port hardcoded
```

---

## ISSUES
> ðŸ› CURRENT KNOWN ISSUES
```yaml
# Add known issues here
```

---

## CHANGES
> ðŸ“ RECENT CHANGES (Last 10)
```yaml
- 2025-12-06 13:20: Initial Guardian scan | auto-generated
```

---

## AGENT_RULES
> ðŸ¤– YOU MUST FOLLOW THESE

### Before ANY Action:
1. âœ… Read this snapshot
2. âœ… Check FILES - does similar exist?
3. âœ… Check LOCKED - am I violating any?
4. âœ… Check DANGER - is this risky?

### Before Creating File:
- CHECK: FILES section for same purpose
- IF EXISTS: Ask "ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ Ø£Ù… Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙŠØ¯ØŸ"
- LOCATION: Follow existing folder pattern

### After ANY Change:
- UPDATE: FILES if new file created
- UPDATE: CHANGES section
