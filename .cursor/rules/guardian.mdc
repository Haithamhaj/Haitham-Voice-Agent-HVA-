---
description: PROJECT MEMORY - READ THIS BEFORE ANSWERING
globs: 
---

# üõ°Ô∏è Project Guardian: HVA Memory

> **DO NOT DELETE OR IGNORE THIS FILE.**
> This file is the "Long Term Memory" of the project.
> It contains the Source of Truth for tech stack, file structure, and current state.

---

## üèóÔ∏è Tech Stack (The "No-Go" Zone)

> **CRITICAL:** Do NOT suggest changes to these unless explicitly asked.

| Layer | Technology | Details |
|-------|------------|---------|
| **Frontend** | React 19 + Vite | TailwindCSS, Lucide React |
| **Desktop** | Electron 39 | `desktop/` folder |
| **Backend** | Python FastAPI | `api/` folder, Uvicorn |
| **AI/Voice** | Faster Whisper | `haitham_voice_agent/` |
| **Database** | ChromaDB + SQLite | Vector + Graph + Relational Memory |

---

## üó∫Ô∏è File Map (Where things live)

> **CRITICAL:** Do NOT create new files outside these conventions.
> **CRITICAL PATH:** `/Users/haitham/development` is the PRIMARY location for all projects.

```
/Users/haitham/development/Haitham Voice Agent (HVA)/
‚îú‚îÄ‚îÄ desktop/                  # Electron + React Frontend
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/            # UI Pages (ChatView.jsx)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/       # Reusable UI
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ context/          # Global State (WebSocketContext)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ services/         # API Client (api.js)
‚îÇ   ‚îú‚îÄ‚îÄ main.js               # Electron Main Process
‚îÇ   ‚îî‚îÄ‚îÄ package.json          # Frontend Deps
‚îú‚îÄ‚îÄ api/                      # FastAPI Backend
‚îÇ   ‚îú‚îÄ‚îÄ routes/               # API Endpoints (voice, chat, files)
‚îÇ   ‚îî‚îÄ‚îÄ main.py               # Server Entry Point
‚îú‚îÄ‚îÄ haitham_voice_agent/      # Core AI Logic
‚îÇ   ‚îú‚îÄ‚îÄ tools/                # Tools (files, voice, memory)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ memory/           # Memory System (SQLite, Vector, Graph)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ projects.py       # Project Registry
‚îÇ   ‚îú‚îÄ‚îÄ intelligence/         # AI Intelligence Layer
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ content_extractor.py # Smart Content Extraction
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ smart_summarizer.py  # Hybrid Summarization (Qwen/Gemini)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ file_router.py       # Auto-Index Logic
‚îÇ   ‚îú‚îÄ‚îÄ llm_router.py         # LLM Decision Logic
‚îÇ   ‚îî‚îÄ‚îÄ dispatcher.py         # Tool Execution
‚îî‚îÄ‚îÄ start_hva.sh              # Startup Script
```

---

## üö¶ Running Now (Don't start duplicates!)

| Service | Port | Command | Status |
|---------|------|---------|--------|
| **Backend** | `8765` | `./start_hva.sh` | ‚úÖ Running |
| **Frontend** | `5173` | `npm run dev` | ‚úÖ Running |

---

## üìù Change Management Rules

### 1. PURE_UI_STYLE (Low Risk)
*Examples: Colors, spacing, text changes, CSS tweaks.*
- **Action:** Just do it. No deep planning needed.

### 2. UI_BEHAVIOUR_TWEAK (Medium Risk)
*Examples: Button clicks, form validation, loading states.*
- **Action:** Check `api.js` first. Ensure backend supports it.

### 3. NEW_FEATURE_FLOW (High Risk)
*Examples: New page, new API route, new tool.*
- **Action:**
  1. **Plan:** Create/Update `implementation_plan.md`
  2. **Review:** Ask user for approval
  3. **Execute:** Implement step-by-step

---

## üêõ Known Issues (Don't rediscover them)

- **Voice/Chat Sync:** Bot sometimes responds before transcript appears (Fix in progress).
- **Microphone:** Sometimes gets stuck if stop signal isn't received (Fixed via WebSocketContext).

---

## üîÑ Recent Changes (Context)

- **[2025-12-03]** Added `files` tool and API route for opening files.
- **[2025-12-03]** Fixed `FileTools` to include directories and handle aliases (download -> Downloads).
- **[2025-12-03]** Integrated Voice & Chat into unified UI (`ChatView.jsx`).
- **[2025-12-03]** Created `WebSocketContext` for global voice state.
- **[2025-12-03]** Updated Dashboard header font size to `text-5xl` (PURE_UI_STYLE).
- **[2025-12-03]** Updated ChatView header font size to `text-5xl` (PURE_UI_STYLE).

---

## üí¨ When Unsure

> "I see [X] in the project memory. Before I proceed:
> - Is [server] currently running on port [PORT]?
> - Should I modify [existing file] or create new?"

**Never assume. Always verify.**


## üìù Recent Changes

| Date | Type | Description | Files |
| 2025-12-04 13:50 | BUG_FIX_FLOW | Fixed **File Tree Interaction**: Added click handler to `FileSystemTree` to open files using the system default app via `/files/open` API. | desktop/src/components/dashboard/FileSystemTree.jsx |
| 2025-12-04 12:30 | NEW_FEATURE_FLOW | Implemented Deep Documents Organizer. Added DeepOrganizer class for content-based renaming and reorganization with Dry Run mode. | haitham_voice_agent/tools/deep_organizer.py, haitham_voice_agent/tools/files.py, api/routes/files.py |
| 2025-12-04 12:10 | NEW_FEATURE_FLOW | Implemented Tokenization Tracker. Added TokenTracker backend, SQLite storage, API endpoints, and Frontend Usage Widget for real-time cost monitoring. | haitham_voice_agent/token_tracker.py, desktop/src/components/dashboard/UsageWidget.jsx |
| 2025-12-04 11:58 | NEW_FEATURE_FLOW | Implemented Smart Downloads Organizer. Added 72h cleanup rule and content-based categorization (LLM) with subfolder support (Category/Subcategory). | haitham_voice_agent/tools/smart_organizer.py |
| 2025-12-04 11:34 | NEW_FEATURE_FLOW | Implemented Smart Content Extraction. Added ContentExtractor and SmartSummarizer (Qwen/Gemini). Updated MemorySystem to ingest full content and generate summaries. Fixed VectorStore query syntax. | haitham_voice_agent/intelligence/content_extractor.py, haitham_voice_agent/intelligence/smart_summarizer.py, haitham_voice_agent/tools/memory/memory_system.py |
| 2025-12-04 11:00 | NEW_FEATURE_FLOW | Implemented Auto-Index Critical Project Files. Added GraphStore, FileRouter, and extended ProjectRegistry. Created api/routes/files.py for scanning endpoints. | haitham_voice_agent/tools/projects.py, haitham_voice_agent/tools/memory/storage/graph_store.py, haitham_voice_agent/intelligence/file_router.py |
| 2025-12-04 10:06 | NEW_FEATURE_FLOW | Implemented Project Registry and File Index. Created projects.py, updated memory_system.py with file indexing, and integrated files.py to auto-index moved files. | haitham_voice_agent/tools/projects.py, haitham_voice_agent/tools/memory/memory_system.py, haitham_voice_agent/tools/memory/storage/sqlite_store.py |
| 2025-12-04 09:46 | UI_BEHAVIOUR_TWEAK | Implemented confirmation flow (Approve/Reject buttons) for destructive file operations (move_file). Updated ChatView, chat API, and files tool. | haitham_voice_agent/tools/files.py, api/routes/chat.py, desktop/src/pages/ChatView.jsx |
| 2025-12-04 09:04 | UI_BEHAVIOUR_TWEAK | Added move_file capability to FileTools and SystemTools (delegated) to enable file organization. | haitham_voice_agent/tools/files.py, haitham_voice_agent/tools/system_tools.py |
| 2025-12-04 08:54 | BUG_FIX | Fixed file sorting by date/size and resolved 'Action not found' for tasks.add_task. | haitham_voice_agent/tools/files.py, haitham_voice_agent/ollama_orchestrator.py, api/routes/chat.py |
| 2025-12-04 08:43 | UI_BEHAVIOUR_TWEAK | Improved file listing response: added localization and passed full file data to frontend. | api/routes/chat.py |
| 2025-12-04 08:37 | NEW_FEATURE_FLOW | Updated LLM Router and Tools to propagate Gemini/GPT model names to UI. | haitham_voice_agent/llm_router.py, haitham_voice_agent/tools/docs.py, api/routes/chat.py |
|------|------|-------------|-------|
| 2025-12-04 08:37 | NEW_FEATURE_FLOW | Integrated Ollama Orchestrator and added model name display to Chat UI. | api/routes/chat.py, desktop/src/pages/ChatView.jsx |
